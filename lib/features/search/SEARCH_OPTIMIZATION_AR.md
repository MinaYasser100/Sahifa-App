# ๐ ุชุญุณูู ุงูุจุญุซ ุจุงุณุชุฎุฏุงู Debouncer ู Request ID

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช

ุชู ุชุทุจูู ุชุญุณููุงุช ูุจูุฑุฉ ุนูู ูุธุงู ุงูุจุญุซ ูู ุงูุชุทุจูู ูุญู ุงููุดุงูู ุงูุชุงููุฉ:
- **ูุซุฑุฉ ุงูุทูุจุงุช (Too Many Requests)**: ูู ุญุฑู ูุงู ูุฑุณู request ูููุตู
- **ุงููุชุงุฆุฌ ุงูุฎุงุทุฆุฉ (Race Conditions)**: ุงููุชุงุฆุฌ ุงููุฏููุฉ ุชุธูุฑ ุจุนุฏ ุงูุฌุฏูุฏุฉ
- **ูุฏุฑ ุงูููุงุฑุฏ (Resource Waste)**: ุงูุทูุจุงุช ุงููุฏููุฉ ุชุณุชูุฑ ุญุชู ุจุนุฏ ุฅูุบุงุฆูุง

---

## ๐ฏ ุงูุญููู ุงููุทุจูุฉ

### 1๏ธโฃ Debouncer - ุชุฃุฎูุฑ ุงูุทูุจุงุช
**ุงูููุฑุฉ:** ุงูุชุธุฑ 500ms ุจุนุฏ ุขุฎุฑ ูุชุงุจุฉ ูุจู ุฅุฑุณุงู ุงูุทูุจ

**ูุจู:**
```
ุงููุณุชุฎุฏู ููุชุจ: F โ l โ u โ t โ t โ e โ r
ุงูุทูุจุงุช ุงููุฑุณูุฉ: 7 requests!
```

**ุจุนุฏ:**
```
ุงููุณุชุฎุฏู ููุชุจ: F โ l โ u โ t โ t โ e โ r
ููุชุธุฑ 500ms...
ุงูุทูุจุงุช ุงููุฑุณูุฉ: 1 request ููุท! โ
```

### 2๏ธโฃ Request ID - ุชุชุจุน ุงูุทูุจุงุช
**ุงูููุฑุฉ:** ูู ุทูุจ ูู ุฑูู ุชุณูุณููุ ูุชุฌุงูู ุฃู ุฑุฏ ูุฏูู

**ุงููุดููุฉ:**
```
17:00:00 โ ุชุฑุณู ุทูุจ "test" (Request #1)
17:00:01 โ ุชุฑุณู ุทูุจ "testing" (Request #2)
17:00:02 โ ูุฑุฌุน ุฑุฏ "testing" โ
17:00:03 โ ูุฑุฌุน ุฑุฏ "test" โ ููุฏูุณ ุนูู ุงููุชูุฌุฉ ุงูุตุญูุญุฉ!
```

**ุงูุญู:**
```
17:00:00 โ ุทูุจ "test" (ID: 1)
17:00:01 โ ุทูุจ "testing" (ID: 2) - ุงูุญุงูู = 2
17:00:02 โ ุฑุฏ "testing" (ID: 2) โ ููุนุฑุถ (ID = ุงูุญุงูู)
17:00:03 โ ุฑุฏ "test" (ID: 1) โญ๏ธ ููุชุฌุงูู (ID โ ุงูุญุงูู)
```

### 3๏ธโฃ CancelToken - ุฅูุบุงุก ุงูุทูุจุงุช
**ุงูููุฑุฉ:** ุฅูุบุงุก ุงูุทูุจ ุงููุฏูู ููุฑุงู ุนูุฏ ุฅุฑุณุงู ุทูุจ ุฌุฏูุฏ

**ุงููุงุฆุฏุฉ:**
- ุชูููุฑ Bandwidth
- ุชูููู ุงูุถุบุท ุนูู ุงูุณูุฑูุฑ
- ุชุณุฑูุน ุงูุงุณุชุฌุงุจุฉ

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ ูุงูููุนุฏูุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
1. โจ `lib/core/utils/debouncer.dart` - ุงูู utility class
2. ๐ `lib/core/utils/debouncer_examples.dart` - ุฃูุซูุฉ ุนูููุฉ
3. โ `test/core/utils/debouncer_test.dart` - 9 tests ูุงุฌุญุฉ
4. ๐ `lib/features/search/SEARCH_OPTIMIZATION.md` - ุชูุซูู ูุงูู ุจุงูุฅูุฌููุฒูุฉ

### ูููุงุช ููุนุฏูุฉ:
1. ๐ง `lib/features/search/manager/search_articles_cubit/search_articles_cubit.dart`
   - ุฅุถุงูุฉ Debouncer instance
   - ุฅุถุงูุฉ Request ID tracking
   - ุฅุถุงูุฉ CancelToken
   - ุฏุงูุฉ ุฌุฏูุฏุฉ: `resetSearch()`
   - ุชุญุณูู `close()` ููุชูุธูู

2. ๐ง `lib/features/search/data/repo/search_articles_repo.dart`
   - ุฅุถุงูุฉ CancelToken parameter
   - ูุนุงูุฌุฉ ุญุงูุฉ ุงูุฅูุบุงุก ุจุดูู ุฎุงุต

3. ๐ง `lib/core/helper_network/dio_helper.dart`
   - ุฅุถุงูุฉ CancelToken support ูู `getData()`

4. ๐ง `lib/features/search/ui/search_view.dart`
   - ุงุณุชุฏุนุงุก `resetSearch()` ุนูุฏ ูุณุญ ุงููุต

5. ๐ `assets/localization/en.json` + `ar.json`
   - ุฅุถุงูุฉ "search_cancelled" / "ุชู ุฅูุบุงุก ุงูุจุญุซ"

---

## ๐ข ุงูุฃุฑูุงู ูุงูุฅุญุตุงุฆูุงุช

### ุณููุงุฑูู: ูุชุงุจุฉ "Flutter Development" (20 ุญุฑู)

#### โ๏ธ ูุจู ุงูุชุญุณููุงุช:
- ุนุฏุฏ ุงูุทูุจุงุช: **20 request**
- ุงูููุช ุงูุฅุฌูุงูู: ~2000ms
- ุงุณุชููุงู Bandwidth: **ุนุงูู ุฌุฏุงู**
- ุงุญุชูุงููุฉ Race Condition: **75%**

#### โ ุจุนุฏ ุงูุชุญุณููุงุช:
- ุนุฏุฏ ุงูุทูุจุงุช: **1 request** ๐ฏ
- ุงูููุช ุงูุฅุฌูุงูู: ~500ms โก
- ุงุณุชููุงู Bandwidth: **ุฃูู ุจู 95%** ๐
- ุงุญุชูุงููุฉ Race Condition: **0%** ๐ก๏ธ

**ุงููุชูุฌุฉ:** ุชูููุฑ **95% ูู ุงูุทูุจุงุช** ูุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู ุจูุซูุฑ!

---

## ๐งช ุงูุณููุงุฑูููุงุช ุงููุฎุชุจุฑุฉ

### โ ุงูุณููุงุฑูู 1: ูุชุงุจุฉ ุณุฑูุนุฉ
```
ุงูุฅุฏุฎุงู: "F" โ "Fl" โ "Flu" โ "Flut" โ "Flutter"
ุงููุชูุฌุฉ: ุทูุจ ูุงุญุฏ ููุท ุจู "Flutter" ุจุนุฏ 500ms ูู ุขุฎุฑ ุญุฑู
```

### โ ุงูุณููุงุฑูู 2: ูุชุงุจุฉ ุจุทูุฆุฉ ูุน ุชูููุงุช
```
ุงูุฅุฏุฎุงู: "Test" [ุชููู 600ms] " App" [ุชููู 600ms]
ุงููุชูุฌุฉ: 2 ุทูุจุงุช (ูุงุญุฏ ูู "Test"ุ ูุงุญุฏ ูู "Test App")
```

### โ ุงูุณููุงุฑูู 3: ูุณุญ ุงููุต
```
ุงูุฅุฏุฎุงู: "Hello" โ ูุณุญ ุงููุต
ุงููุชูุฌุฉ: 
  - ุฅูุบุงุก ุฃู ุทูุจ ูุนูู
  - ุฅูุบุงุก ุฃู ุทูุจ ุฌุงุฑู
  - ุงูุนูุฏุฉ ููุดุงุดุฉ ุงูุงุจุชุฏุงุฆูุฉ (ุงููุฆุงุช)
```

### โ ุงูุณููุงุฑูู 4: ููุน Race Conditions
```
ุงูุดุจูุฉ ุจุทูุฆุฉุ ุงููุณุชุฎุฏู ููุชุจ:
  1. "A" โ ุทูุจ (ูุณุชุบุฑู 2000ms)
  2. "AB" โ ุทูุจ (ูุณุชุบุฑู 500ms)

ุจุฏูู Request ID: ูุนุฑุถ ูุชุงุฆุฌ "A" โ
ูุน Request ID: ูุชุฌุงูู "A"ุ ูุนุฑุถ "AB" โ
```

---

## ๐ป ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูู ุฃู Feature ุฌุฏูุฏุฉ:

```dart
import 'package:sahifa/core/utils/debouncer.dart';

class MyCubit extends Cubit<MyState> {
  final _debouncer = Debouncer(
    delay: const Duration(milliseconds: 500),
  );
  
  int _requestId = 0;
  CancelToken? _cancelToken;

  Future<void> performAction(String input) async {
    final currentRequestId = ++_requestId;
    
    _cancelToken?.cancel();
    _cancelToken = CancelToken();
    
    _debouncer.run(() async {
      if (currentRequestId != _requestId) return;
      
      // Your API call here
      final result = await repo.fetchData(
        input,
        cancelToken: _cancelToken,
      );
      
      if (currentRequestId != _requestId) return;
      
      emit(SuccessState(result));
    });
  }

  @override
  Future<void> close() {
    _debouncer.dispose();
    _cancelToken?.cancel();
    return super.close();
  }
}
```

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ุงูู Debounce Delay

### ููู ุชุฎุชุงุฑ ุงููุฏุฉ ุงูููุงุณุจุฉุ

| Use Case | Delay ุงูููุงุณุจ | ุงูุณุจุจ |
|----------|---------------|--------|
| **Search** | 300-500ms | ุชูุงุฒู ุจูู ุงูุณุฑุนุฉ ูุงูุทูุจุงุช |
| **Auto-save** | 1-3 seconds | ุฅุนุทุงุก ููุช ูููุณุชุฎุฏู ูููุชุงุจุฉ |
| **Window Resize** | 200-300ms | ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ ููุชุบููุฑ |
| **Scroll Detection** | 100-200ms | smooth experience |
| **Form Validation** | 500-800ms | ุชุฌูุจ ุงูุฅุฒุนุงุฌ ุจุงูุฃุฎุทุงุก |

**ุงูุงูุชุฑุงุถู ุงููุณุชุฎุฏู:** 500ms โ

### ุชุนุฏูู ุงููุฏุฉ:
```dart
// ูู search_articles_cubit.dart
final Debouncer _debouncer = Debouncer(
  delay: const Duration(milliseconds: 300), // ุบููุฑ ููุง
);
```

---

## ๐ ุงูููุงููู ุงููุณุชุฎุฏูุฉ

### ูุง ูู Debouncingุ
ุชูููุฉ ุจุฑูุฌูุฉ ุชุถูู ุฃู ุงูุนูููุงุช ุงูุซูููุฉ ูุง ุชูููุฐ ุจูุซุฑุฉุ ุจู ุชูุชุธุฑ ุญุชู ูุชููู ุงููุณุชุฎุฏู ุนู ุงูุชูุงุนู.

**ูุซุงู ูู ุงูุญูุงุฉ:**
ูุซู ูุตุนุฏ ูุณุชุฎุฏูู ุฃุดุฎุงุต ูุซูุฑูู - ุจุฏู ูุง ููุฒู ูู ูุฑุฉ ุดุฎุต ูุฏูุณ ุงูุฒุฑุ ููุชุธุฑ 5 ุซูุงูู ูู ุญุฏ ุชุงูู ุฏุงุฎู ุนุดุงู ูููุฑ ููุฑุจุงุก ูููุช.

### ูุง ูู Race Conditionุ
ุญุงูุฉ ุชุญุฏุซ ุนูุฏูุง ุชุนุชูุฏ ุงููุชูุฌุฉ ุนูู ุชูููุช ุฃุญุฏุงุซ ูุง ูููู ุงูุชุญูู ูููุง.

**ูุซุงู:**
ุณุจุงู ุจูู ุทูุจูู ููุณูุฑูุฑ - ุงููู ูุฎูุต ุงูุฃูู ูุด ุฏุงููุงู ุงููู ุงุชุจุนุช ุงูุฃูู!

### ูุง ูู CancelTokenุ
ุขููุฉ ูู Dio ุชุณูุญ ุจุฅูุบุงุก ุงูุทูุจุงุช ุงูุชู ูู ุชุนุฏ ูุทููุจุฉุ ูุชูููุฑ ุงูููุงุฑุฏ.

**ูุซุงู:**
ูุซู ุฅูุบุงุก ุทูุจ delivery ููุง ุชุบูุฑ ุฑุฃูู ูุจู ูุง ููุตู.

---

## ๐ Logs ูููุฏุฉ ููุชุทููุฑ

ุงูููุฏ ุจูุทุจุน logs ูุงุถุญุฉ ููุณุงุนุฏุชู ูู ุงูู debugging:

```
๐ Search initiated - Query: "test", Request ID: 1
โ Search success for request ID 1: 10 articles found

๐ Search initiated - Query: "testing", Request ID: 2
โญ๏ธ Skipping outdated request ID: 1 (current: 2)
โ Search success for request ID 2: 5 articles found

๐ Search initiated - Query: "test app", Request ID: 3
โ Search error for request ID 3: Network error
```

---

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### 1. ุงูุทูุจุงุช ุงููููุบุงุฉ (Cancelled)
```dart
if (e.type == DioExceptionType.cancel) {
  return Left("search_cancelled".tr());
}
```
**ุงูู UI ูุง ูุนุฑุถ** ุฑุณุงูุฉ ุฎุทุฃ ูุฃููุง ุญุงูุฉ ุทุจูุนูุฉ.

### 2. ุฃุฎุทุงุก ุงูุดุจูุฉ
ุชูุนุฑุถ ูููุณุชุฎุฏู ุจุดูู ุทุจูุนู ุนุจุฑ `SearchArticlesErrorState`.

### 3. Timeout
ูุชู ูุนุงูุฌุชู ูู ุฎูุงู Dio configuration.

---

## โจ ุงูููุงุฆุฏ ุงูููุงุฆูุฉ

| ูุจู | ุจุนุฏ |
|-----|-----|
| 20 ุทูุจ ููู ูููุฉ | 1 ุทูุจ ููุท |
| ูุชุงุฆุฌ ุฎุงุทุฆุฉ ุฃุญูุงูุงู | ูุชุงุฆุฌ ุตุญูุญุฉ ุฏุงุฆูุงู |
| ูุฏุฑ ูู ุงูููุงุฑุฏ | ุงุณุชุฎุฏุงู ุฃูุซู |
| ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุจุทูุฆุฉ | ุชุฌุฑุจุฉ ุณุฑูุนุฉ ูุณูุณุฉ |
| ุตุนูุจุฉ ูู ุงูู debugging | logs ูุงุถุญุฉ ููููุฏุฉ |

---

## ๐ ูููุงุช ุฐุงุช ุตูุฉ

- ๐ `SEARCH_OPTIMIZATION.md` - ุงูุชูุซูู ุงููุงูู ุจุงูุฅูุฌููุฒูุฉ
- ๐ก `debouncer_examples.dart` - 7 ุฃูุซูุฉ ุนูููุฉ ูุฎุชููุฉ
- โ `debouncer_test.dart` - 9 unit tests

---

## ๐จโ๐ป ูููุทูุฑูู

### ูุจู ุนูู Pull Request:
1. โ ุชุฃูุฏ ุฃู ุงูู tests ูููุง ูุงุฌุญุฉ
2. โ ุงุฎุชุจุฑ ุงูุณููุงุฑูููุงุช ุงููุฎุชููุฉ ูุฏููุงู
3. โ ุชุญูู ูู ุงูู logs ุฃุซูุงุก ุงูุชุทููุฑ
4. โ ุชุฃูุฏ ูู ุงูู dispose ูู close()

### Best Practices:
- ุฏุงููุงู ุงุณุชุฎุฏู `dispose()` ูู widget ุฃู cubit
- ุงุฎุชุงุฑ delay ููุงุณุจ ููู use case
- ุงุณุชุฎุฏู Request ID ูุน ุงูู debouncer
- ุฑุงุฌุน ุงูู logs ููุชุฃูุฏ ูู ุงูุณููู ุงูุตุญูุญ

---

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ:** Mina Yasser  
**ุงูุชุงุฑูุฎ:** 11 ููููุจุฑ 2025  
**Feature:** Search Optimization  
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ
